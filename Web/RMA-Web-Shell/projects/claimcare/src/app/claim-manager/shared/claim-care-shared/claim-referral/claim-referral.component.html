<mat-card *ngIf="isLoading$ | async">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <label class="mat-label other-label"><i>{{loadingMessages$ | async}}</i></label>
</mat-card>

<mat-card>
    <div class="menu-bar">
        <span class="material-icons">
            assignment_ind
        </span>&nbsp;
        <label>Payment Referral</label>
        <span class="material-icons menu-button" (click)="cancel()">
            close
        </span>
        <span *ngIf="(canSendReferral$ | async)" class="material-icons menu-button pulseGreen" (click)="save()">
            save
        </span>
    </div>
</mat-card>

<div [hidden]="(isLoading$ | async)">
    <mat-card>
        <form [formGroup]="form" class="mat-container" novalidate>
            <section>
                <mat-form-field class="mat-form-field">
                    <label class="mat-label other-label mandatory">Date Created</label>
                    <input matInput formControlName="dateCreated" [matDatepicker]="dateCreated">
                    <mat-datepicker-toggle matSuffix [for]="dateCreated">
                    </mat-datepicker-toggle>
                    <mat-datepicker touchUi="true" #dateCreated></mat-datepicker>
                </mat-form-field>
                <mat-form-field class="mat-form-field-right">
                    <label class="mat-label other-label">Generated By</label>
                    <input matInput formControlName="generatedBy" name="generatedBy" id="generatedBy" />
                </mat-form-field>
            </section>
            <section>
                <mat-form-field class="mat-form-field">
                    <label class="mat-label other-label">Referral Type</label>
                    <mat-select name="referralType" id="referralType" formControlName="referralType"
                        (selectionChange)="referralTypeChange($event.value)">
                        <mat-option *ngFor="let type of referralTypes" [value]="type">
                            {{formatLookup(type)}}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="form.get('referralType').hasError('required')">
                        referral type is <strong>required</strong>
                    </mat-error>
                </mat-form-field>
                <mat-form-field class="mat-form-field-right">
                    <label class="mat-label other-label">Claim Number</label>
                    <input matInput formControlName="claimNumber" name="claimNumber" id="claimNumber" />
                </mat-form-field>
            </section>
            <section>
                <mat-form-field class="mat-form-field">
                    <label class="mat-label other-label">Member Name</label>
                    <input matInput formControlName="insuredLifeName" name="insuredLifeName" id="insuredLifeName" />
                </mat-form-field>
                <mat-form-field class="mat-form-field-right">
                    <label class="mat-label other-label">Contact Number</label>
                    <input matInput formControlName="contactNumber" name="contactNumber" id="contactNumber" />
                </mat-form-field>
            </section>
            <section>
                <mat-form-field class="mat-form-field">
                    <label class="mat-label other-label">Message</label>
                    <textarea matInput formControlName="message" name="message" id="message" rows="8"
                        cols="80"></textarea>
                        <mat-error *ngIf="form.get('message').hasError('required')">
                            message is <strong>required</strong>
                        </mat-error>
                </mat-form-field>
            </section>
        </form>
    </mat-card>

    <div *ngIf="this.form.valid">
        <user-search-V2 [title]="'Users with Payment Permissions'" [allowMultiple]="true"
            [permissions]="data.permissions" (usersSelectedEmit)="usersSelected($event)"></user-search-V2>
    </div>
</div>